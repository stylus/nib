/*
 * Define background-image as `path` with optional width and height, adding an
 * @2x variant.
 *
 */

image(path, w = auto, h = auto, min_pixel_ratio = 1.5)
  background-image: url(path)

  @media all and (-webkit-min-device-pixel-ratio: min_pixel_ratio),
    (min--moz-device-pixel-ratio: min_pixel_ratio),
    (-o-min-device-pixel-ratio: min_pixel_ratio/1),
    (min-device-pixel-ratio: min_pixel_ratio),
    (min-resolution: unit(min_pixel_ratio*92, dpi)),
    (min-resolution: unit(min_pixel_ratio, dppx))

    ext = extname(path)
    path = pathjoin(dirname(path), basename(path, ext) + '@2x' + ext)
    background-image: url(path)
    if w in (cover contain) and h == auto
        h = null
    background-size: w h
